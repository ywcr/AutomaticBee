# 精灵蜂自动化任务管理平台 - 整合方案

## 概述

本项目将原有的问卷自动化脚本和验证工具整合到 Electron 应用中，提供统一的自动化任务管理平台。

## 核心功能

### 1. 任务自动化引擎 (TaskAutomationEngine)
- **Excel 数据处理**: 解析上传的 Excel 文件，按指派人分组
- **批量任务执行**: 支持批量创建联系人和问卷
- **进度监控**: 实时显示任务执行进度
- **错误处理**: 自动重试和错误记录

### 2. API 管理器 (APIManager)
- **统一 API 接口**: 封装所有与 zxyy.ltd 的 API 交互
- **认证管理**: 自动检查和管理登录状态
- **请求封装**: 统一的错误处理和重试机制
- **问卷生成**: 自动生成问卷答案

### 3. 数据验证模块 (DataValidationModule)
- **创建结果验证**: 对比本地数据与已创建的问卷
- **遗漏检测**: 自动识别未创建的问卷
- **批量验证**: 支持日期范围的批量验证
- **自动补漏**: 自动重新创建遗漏的问卷

### 4. 任务队列管理 (TaskQueueManager)
- **任务排队**: 支持任务的排队和优先级管理
- **并发控制**: 可配置的并发执行数量
- **生命周期管理**: 支持暂停、继续、停止操作
- **状态跟踪**: 完整的任务状态跟踪

### 5. 配置管理系统 (ConfigManager)
- **灵活配置**: 支持 API、执行、UI 等各种配置
- **配置模板**: 预设的开发、生产、测试环境配置
- **导入导出**: 支持配置的备份和恢复
- **实时更新**: 配置变更实时生效

## 界面功能

### 仪表板
- 系统概览和统计信息
- 最近活动和系统状态
- 快速操作入口

### 数据导入
- 问卷类型选择
- 项目管理
- Excel 文件上传和解析
- 数据预览和过滤

### 任务管理
- 指派人管理
- 任务创建和执行控制
- 实时进度监控
- 执行参数设置

### 数据验证
- 单日和批量验证
- 验证结果展示
- 自动补漏工具
- 报告导出

### 任务队列
- 队列状态监控
- 任务分类管理
- 批量操作

### 日志管理
- 分级日志显示
- 日志过滤和搜索
- 日志导出

### 系统设置
- 多标签页配置界面
- 实时配置更新
- 配置导入导出

## 技术架构

```
┌─────────────────────────────────────────────────────────────┐
│                    Electron 主进程                          │
├─────────────────────────────────────────────────────────────┤
│  ┌─────────────────┐  ┌─────────────────┐  ┌─────────────────┐ │
│  │  TaskAutomation │  │   APIManager    │  │ DataValidation  │ │
│  │     Engine      │  │                 │  │     Module      │ │
│  └─────────────────┘  └─────────────────┘  └─────────────────┘ │
│  ┌─────────────────┐  ┌─────────────────┐                     │
│  │ TaskQueueManager│  │  ConfigManager  │                     │
│  │                 │  │                 │                     │
│  └─────────────────┘  └─────────────────┘                     │
├─────────────────────────────────────────────────────────────┤
│                    IPC 通信层                                │
├─────────────────────────────────────────────────────────────┤
│                   渲染进程 (Web UI)                          │
│  ┌─────────────────────────────────────────────────────────┐ │
│  │              自动化平台界面                              │ │
│  │  ┌─────────┐ ┌─────────┐ ┌─────────┐ ┌─────────┐        │ │
│  │  │ 仪表板  │ │数据导入 │ │任务管理 │ │数据验证 │        │ │
│  │  └─────────┘ └─────────┘ └─────────┘ └─────────┘        │ │
│  │  ┌─────────┐ ┌─────────┐ ┌─────────┐                   │ │
│  │  │任务队列 │ │日志管理 │ │系统设置 │                   │ │
│  │  └─────────┘ └─────────┘ └─────────┘                   │ │
│  └─────────────────────────────────────────────────────────┘ │
└─────────────────────────────────────────────────────────────┘
```

## 安装和使用

### 1. 安装依赖
```bash
cd liuwei/electron-zxyy
npm install
```

### 2. 开发模式启动
```bash
npm run dev
```

### 3. 生产模式启动
```bash
npm start
```

### 4. 构建应用
```bash
npm run build
```

## 使用流程

### 1. 数据导入流程
1. 选择问卷类型（六味患者问卷/西黄消费者问卷）
2. 刷新并选择项目
3. 上传 Excel 文件
4. 设置日期过滤条件
5. 预览数据并确认

### 2. 任务执行流程
1. 在数据导入完成后，选择要执行的任务类型：
   - 仅创建联系人
   - 仅创建问卷
   - 联系人+问卷（全部创建）
2. 设置执行参数（并发数、延迟时间等）
3. 开始执行并监控进度
4. 处理执行结果和错误

### 3. 数据验证流程
1. 选择验证日期或日期范围
2. 执行验证操作
3. 查看验证结果
4. 对遗漏的数据执行自动补漏
5. 导出验证报告

## 配置说明

### API 配置
- `baseUrl`: API 基础地址
- `timeout`: 请求超时时间
- `retryAttempts`: 重试次数

### 执行配置
- `concurrency`: 并发执行数量
- `stepDelay`: 步骤间延迟时间
- `maxRetries`: 最大重试次数

### 验证配置
- `autoValidateAfterCreation`: 创建后自动验证
- `validationDelay`: 验证延迟时间

## 与原有脚本的对比

| 功能 | 原有脚本 | 整合后平台 |
|------|----------|------------|
| 界面 | 浏览器插件弹窗 | 统一的桌面应用界面 |
| 数据管理 | 手动上传和处理 | 自动化数据处理和管理 |
| 任务执行 | 手动触发 | 队列化自动执行 |
| 进度监控 | 简单的控制台输出 | 实时进度条和详细状态 |
| 错误处理 | 基础的重试机制 | 完整的错误管理和恢复 |
| 配置管理 | 硬编码配置 | 灵活的配置系统 |
| 数据验证 | 独立的验证脚本 | 集成的验证模块 |

## 优势

1. **统一界面**: 所有功能集成在一个应用中，操作更便捷
2. **自动化程度更高**: 减少手动操作，提高效率
3. **更好的错误处理**: 完整的错误管理和恢复机制
4. **实时监控**: 详细的进度显示和状态跟踪
5. **配置灵活**: 支持多种配置选项和环境切换
6. **数据安全**: 本地存储，避免数据泄露
7. **扩展性强**: 模块化设计，易于添加新功能

## 注意事项

1. 首次使用需要确保已登录 zxyy.ltd 系统
2. Excel 文件格式需要符合预定义的结构
3. 执行大批量任务时建议适当调整并发数和延迟时间
4. 定期备份配置和重要数据
5. 遇到网络问题时可以暂停任务，网络恢复后继续执行

## 故障排除

### 常见问题
1. **认证失败**: 检查是否已登录 zxyy.ltd 系统
2. **文件解析失败**: 确认 Excel 文件格式正确
3. **任务执行失败**: 检查网络连接和 API 配置
4. **验证结果不准确**: 确认项目ID和日期设置正确

### 日志查看
- 在"日志管理"页面查看详细的执行日志
- 根据日志级别过滤相关信息
- 导出日志用于问题分析

## 未来扩展

1. **更多问卷类型支持**: 支持其他类型的问卷自动化
2. **数据分析功能**: 添加数据统计和分析功能
3. **定时任务**: 支持定时自动执行任务
4. **多用户支持**: 支持多个账号的任务管理
5. **云端同步**: 支持配置和数据的云端同步
